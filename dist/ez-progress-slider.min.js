angular.module("ez.progressSlider",[]).constant("EzProgressSliderConfig",{draggableTarget:!1,draggableProgress:!0}).directive("ezProgressSlider",["$parse","EzProgressSliderConfig",function(a,b){return{restrict:"EA",templateUrl:"ez-progress-slider-tpl.html",replace:!0,scope:{progress:"=",target:"=?",config:"=?"},link:function(c,d,e){d.wrap('<div class="ez-progress-slider progress"></div>'),c.options=angular.extend({},b,c.config),c.hasTarget=!!e.target,e.draggableProgress&&(c.options.draggableProgress=a(e.draggableProgress)(c.$parent)),e.draggableTarget&&(c.options.draggableTarget=a(e.draggableTarget)(c.$parent));var f,g=d[0],h=d.parent(),i=h.parent(),j=g.children[0],k=g.children[1],l=g.children[2],m=function(){f=i.width()},n=function(a,b){return a=parseInt(a,10),b=parseInt(b,10),b>0?Math.round(a/b*100):0},o=function(a){return m(),a?parseInt((a*f/100).toFixed(0),10):0},p=o(c.progress),q=function(b){0>=f||(g.style.width=p+"px",j.style.left=p-10+"px",l.innerHTML=Math.round(c.progress)+"%",c.progress<=50?h.addClass("under-50"):h.removeClass("under-50"),s(),r(),b&&(c.$apply(),e.onChange&&(a(e.onChange)(c.$parent,{progress:c.progress,target:c.target}),c.$apply())))},r=function(){c.hasTarget&&(c.progress<c.target?g.classList.add("progress-bar-danger"):g.classList.remove("progress-bar-danger"))},s=function(){35>p?(l.style.left=p+20+"px",l.style.color="#333"):(l.style.left="5px",l.style.color="#fff")};if(c.options.draggableProgress&&(h.addClass("draggable-progress"),interact(j).draggable({axis:"x",onstart:function(){p=o(c.progress)},onmove:function(a){return p+=a.dx,s(),0>p||p>f?void(p-=a.dx):(c.progress=n(p,f),void q())},onend:function(){q(!0)}}),h.on("mousedown",function(a){var b=angular.element(a.target);(b.hasClass("ez-progress-slider")||b.hasClass("progress-bar"))&&(p=a.offsetX,c.progress=n(p,f),q(!0))})),c.hasTarget){var t=o(c.target),u=function(b){k.style.left=t-6+"px",k.setAttribute("title",c.target+"%"),r(),b&&(c.$apply(),e.onChange&&(a(e.onChange)(c.$parent,{progress:c.progress,target:c.target}),c.$apply()))};c.options.draggableTarget&&(h.addClass("draggable-target"),interact(k).draggable({axis:"x",onstart:function(){t=o(c.target)},onmove:function(a){return t+=a.dx,0>t||t>f?void(t-=a.dx):(c.target=n(t,f),void u())},onend:function(){u(!0)}})),u()}else k.remove();q(),setTimeout(function(){g.parentNode.classList.add("ez-loaded")},1e3)}}}]);