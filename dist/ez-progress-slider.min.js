angular.module("ez.progressSlider",[]).constant("EzProgressSliderConfig",{draggableTarget:!1,draggableProgress:!0}).directive("ezProgressSlider",["$parse","EzProgressSliderConfig",function(a,b){return{restrict:"EA",templateUrl:"ez-progress-slider-tpl.html",replace:!0,scope:{progress:"=",target:"=?",config:"=?",onChange:"=?"},link:function(a,c){c.wrap('<div class="ez-progress-slider progress"></div>'),a.options=angular.extend({},b,a.config),a.hasTarget=a.hasOwnProperty("target");var d,e=c[0],f=c.parent(),g=f.parent(),h=e.children[0],i=e.children[1],j=e.children[2],k=function(){d=g.width()},l=function(a,b){return a=parseInt(a,10),b=parseInt(b,10),b>0?Math.round(a/b*100):0},m=function(a){return k(),a?parseInt((a*d/100).toFixed(0),10):0},n=m(a.progress),o=function(){0>=d||(e.style.width=n+"px",h.style.left=n-10+"px",j.innerHTML=Math.round(a.progress)+"%",p())},p=function(){a.hasTarget&&(a.progress<a.target?e.classList.add("progress-bar-danger"):e.classList.remove("progress-bar-danger"))};if(a.options.draggableProgress&&(f.addClass("draggable-progress"),interact(h).draggable({axis:"x",onstart:function(){n=m(a.progress)},onmove:function(b){return n+=b.dx,0>n||n>d?void(n-=b.dx):(a.progress=l(n,d),void o())},onend:function(){a.$apply()}}).actionChecker(function(a,b){return 3===a.which?null:b}),f.on("mousedown",function(b){var c=angular.element(b.target);(c.hasClass("ez-progress-slider")||c.hasClass("progress-bar"))&&(n=b.offsetX,a.$apply(function(){a.progress=l(n,d)}))})),a.hasTarget){var q,r=function(){i.style.left=q-6+"px",i.setAttribute("title",a.target+"%"),p()};a.options.draggableTarget&&(f.addClass("draggable-target"),interact(i).draggable({axis:"x",onstart:function(){q=m(a.target)},onmove:function(b){return q+=b.dx,0>q||q>d?void(q-=b.dx):(a.target=l(q,d),void r())},onend:function(){a.$apply()}}).actionChecker(function(a,b){return 3===a.which?null:b})),a.$watch("target",function(b,c){return b=parseInt(b,10),b>100?a.target=100:0>b?a.target=0:(q=m(b),r(),void(b!==c&&"function"==typeof a.onChange&&a.onChange()))})}else i.remove();a.$watch("progress",function(b,c){return b=parseInt(b,10),b>100?a.progress=100:0>b?a.progress=0:(n=m(b),o(),void(b!==c&&"function"==typeof a.onChange&&a.onChange()))}),setTimeout(function(){e.parentNode.classList.add("ez-loaded")},1e3)}}}]);