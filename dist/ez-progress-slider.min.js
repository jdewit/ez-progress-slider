angular.module("ez.progressSlider",[]).constant("EzProgressSliderConfig",{draggableTarget:!1,draggableProgress:!0,showProgressHandle:!0,showTargetHandle:!0,inverseProgress:!1}).directive("ezProgressSlider",["$parse","EzProgressSliderConfig",function(a,b){return{restrict:"EA",templateUrl:"ez-progress-slider-tpl.html",replace:!0,require:"ngModel",scope:{disabled:"=?ngDisabled",target:"=?",config:"=?",delay:"=?"},link:function(c,d,e,f){function g(){F(),G(),c.disabled?d.addClass("ez-disabled"):H(),setTimeout(function(){d.addClass("ez-loaded")},1e3),x>0&&setTimeout(function(){f.$render()},x)}c.options=angular.extend({},b,c.config),c.hasTarget=!!e.target;for(var h in b)e[h]&&(c.options[h]=a(e[h])(c.$parent));var i,j,k,l,m,n,o,p,q,r=d.find(".progress"),s=d.find(".progress-bar"),t=d.parent(),u=d.find(".progress-handle"),v=d.find(".target-handle"),w=d.find(".progress-text"),x=parseInt(c.delay)||0;s.height(r.height());var y=function(){console.log("w",t.width()),i=t.width()},z=function(a,b){return a=parseInt(a,10),b=parseInt(b,10),b>0?Math.round(a/b*100):0},A=function(a){return y(),console.log("gett",a),a?parseInt((a*i/100).toFixed(0),10):0},B=function(){0>=i||(s.css({width:k+"px"}),u.css({left:k-10+"px"}),w.text(Math.round(j)+"%"),50>=j?d.addClass("under-50"):d.removeClass("under-50"),D(),C())},C=function(){var a=!1;c.hasTarget&&(l>j&&(a=!0),c.options.inverseProgress&&(a=!a),a?d.addClass("behind-target"):d.removeClass("behind-target"))},D=function(){35>k?(w.css(c.disabled?{left:k+5+"px"}:{left:k+20+"px"}),w.css({color:"#333"})):w.css({color:"#fff",left:"5px"})},E=function(){v.css({left:A(l)+"px"}),v.attr("title",l+"%"),C()},F=function(){console.log("initP",j),j=0,k=A(j),console.log("x,",k),B()},G=function(){q=c.$watch("target",function(a,b){a!==b&&(l=parseInt(a,10)||0,l>100?l=100:0>l&&(l=0),E())}),l=c.target,m=A(l),E()},H=function(){d.removeClass("ez-disabled"),c.disabled||(c.options.draggableProgress&&(d.addClass("draggable-progress"),n=interact(u[0]).draggable({axis:"x",onstart:function(){k=A(j)},onmove:function(a){return k+=a.dx,D(),0>k||k>i?void(k-=a.dx):(j=z(k,i),void B())},onend:function(){B(),f.$setViewValue(j),c.$apply()}}),o=function(a){angular.element(a.target);k=a.offsetX,j=z(k,i),B(),f.$setViewValue(j),c.$apply()},r.on("mousedown",o),s.on("mousedown",o)),c.hasTarget&&c.options.draggableTarget&&(d.addClass("draggable-target"),p=interact(v[0]).draggable({axis:"x",onstart:function(){m=A(c.target)},onmove:function(a){return m+=a.dx,0>m||m>i?void(m-=a.dx):(l=z(m,i),void E())},onend:function(){E(),c.target=l,c.$apply()}})))},I=function(){d.removeClass("draggable-progress"),d.addClass("ez-disabled"),n&&(n.unset(),n=null,r.off("mousedown",o),s.off("mousedown",o)),p&&(d.addClass("draggable-target"),p.unset(),p=null,q())};f.$render=function(){j=parseInt(f.$viewValue,10)||0,j>100?j=100:0>j&&(j=0),k=A(j),B()},c.$watch("disabled",function(a,b){a!==b&&(a?I():H())}),g()}}}]);