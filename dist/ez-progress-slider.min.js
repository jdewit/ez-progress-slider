angular.module("ez.progressSlider",[]).constant("EzProgressSliderConfig",{draggableTarget:!1,draggableProgress:!0,showProgressHandle:!0,showTargetHandle:!0}).directive("ezProgressSlider",["$parse","EzProgressSliderConfig",function(a,b){return{restrict:"EA",templateUrl:"ez-progress-slider-tpl.html",replace:!0,require:"ngModel",scope:{disabled:"=?ngDisabled",target:"=?",config:"=?"},link:function(c,d,e,f){c.options=angular.extend({},b,c.config),c.hasTarget=!!e.target;for(var g in b)e[g]&&(c.options[g]=a(e[g])(c.$parent));var h,i,j,k,l,m,n,o,p,q=d.find(".progress"),r=d.find(".progress-bar"),s=d.parent(),t=d.find(".progress-handle"),u=d.find(".target-handle"),v=d.find(".progress-text");r.height(q.height());var w=function(){h=s.width()},x=function(a,b){return a=parseInt(a,10),b=parseInt(b,10),b>0?Math.round(a/b*100):0},y=function(a){return w(),a?parseInt((a*h/100).toFixed(0),10):0},z=function(){0>=h||(r.css({width:j+"px"}),t.css({left:j-10+"px"}),v.text(Math.round(i)+"%"),50>=i?d.addClass("under-50"):d.removeClass("under-50"),B(),A())},A=function(){c.hasTarget&&(k>i?d.addClass("behind-target"):d.removeClass("behind-target"))},B=function(){35>j?(v.css(c.disabled?{left:j+5+"px"}:{left:j+20+"px"}),v.css({color:"#333"})):v.css({color:"#fff",left:"5px"})},C=function(){u.css({left:y(k)+"px"}),u.attr("title",k+"%"),A()},D=function(){i=0,j=y(i),z()},E=function(){p=c.$watch("target",function(a,b){a!==b&&(k=parseInt(a,10)||0,k>100?k=100:0>k&&(k=0),C())}),k=c.target,l=y(k),C()},F=function(){d.removeClass("ez-disabled"),c.disabled||(c.options.draggableProgress&&(d.addClass("draggable-progress"),m=interact(t[0]).draggable({axis:"x",onstart:function(){j=y(i)},onmove:function(a){return j+=a.dx,B(),0>j||j>h?void(j-=a.dx):(i=x(j,h),void z())},onend:function(){z(),f.$setViewValue(i),c.$apply()}}),n=function(a){angular.element(a.target);j=a.offsetX,i=x(j,h),z(),f.$setViewValue(i),c.$apply()},q.on("mousedown",n),r.on("mousedown",n)),c.hasTarget&&c.options.draggableTarget&&(d.addClass("draggable-target"),o=interact(u[0]).draggable({axis:"x",onstart:function(){l=y(c.target)},onmove:function(a){return l+=a.dx,0>l||l>h?void(l-=a.dx):(k=x(l,h),void C())},onend:function(){C(),c.target=k,c.$apply()}})))},G=function(){d.removeClass("draggable-progress"),d.addClass("ez-disabled"),m&&(m.unset(),m=null,q.off("mousedown",n),r.off("mousedown",n)),o&&(d.addClass("draggable-target"),o.unset(),o=null,p())};f.$render=function(){i=parseInt(f.$viewValue,10)||0,i>100?i=100:0>i&&(i=0),j=y(i),z()},c.$watch("disabled",function(a,b){a!==b&&(a?G():F())}),D(),E(),c.disabled?d.addClass("ez-disabled"):F(),setTimeout(function(){d.addClass("ez-loaded")},1e3)}}}]);