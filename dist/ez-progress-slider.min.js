angular.module("ez.progressSlider",[]).constant("EzProgressSliderConfig",{draggableTarget:!1,draggableProgress:!0,showProgressHandle:!0,showTargetHandle:!0,noInteraction:!1}).directive("ezProgressSlider",["$parse","EzProgressSliderConfig",function(a,b){return{restrict:"EA",templateUrl:"ez-progress-slider-tpl.html",replace:!0,scope:{progress:"=",target:"=?",config:"=?"},link:function(c,d,e){d.wrap('<div class="ez-progress-slider progress"></div>'),c.options=angular.extend({},b,c.config),c.hasTarget=!!e.target;for(var f in b)e[f]&&(c.options[f]=a(e[f])(c.$parent));var g,h=d[0],i=d.parent(),j=i.parent(),k=h.children[0],l=h.children[1],m=h.children[2],n=function(){g=j.width()},o=function(a,b){return a=parseInt(a,10),b=parseInt(b,10),b>0?Math.round(a/b*100):0},p=function(a){return n(),a?parseInt((a*g/100).toFixed(0),10):0},q=function(){0>=g||(h.style.width=x+"px",k.style.left=x-10+"px",m.innerHTML=Math.round(w)+"%",c.progress<=50?i.addClass("under-50"):i.removeClass("under-50"),s(),r())},r=function(){c.hasTarget&&(u>w?h.classList.add("progress-bar-danger"):h.classList.remove("progress-bar-danger"))},s=function(){35>x?(m.style.left=c.options.noInteraction?x+5+"px":x+20+"px",m.style.color="#333"):(m.style.left="5px",m.style.color="#fff")};if(c.options.draggableProgress&&!c.options.noInteraction&&(i.addClass("draggable-progress"),interact(k).draggable({axis:"x",onstart:function(){x=p(c.progress)},onmove:function(a){return x+=a.dx,s(),0>x||x>g?void(x-=a.dx):(w=o(x,g),void q())},onend:function(){c.progress=w,q(),c.$apply()}}),i.on("mousedown",function(a){var b=angular.element(a.target);(b.hasClass("ez-progress-slider")||b.hasClass("progress-bar"))&&(x=a.offsetX,c.progress=w=o(x,g),q(),c.$apply())})),c.hasTarget){var t=function(){l.style.left=p(u)-6+"px",l.setAttribute("title",u+"%"),r()};c.options.draggableTarget&&(i.addClass("draggable-target"),interact(l).draggable({axis:"x",onstart:function(){v=p(c.target)},onmove:function(a){return v+=a.dx,0>v||v>g?void(v-=a.dx):(u=o(v,g),void t())},onend:function(){t(),c.target=u,c.$apply()}})),c.$watch("target",function(b,d){b!==d&&(u=parseInt(b,10)||0,u>100?u=100:0>u&&(u=0),e.onChange&&a(e.onChange)(c.$parent,{progress:w,target:u}),t())});var u=c.target,v=p(u);t()}else c.options.showTargetHandle=!1;c.$watch("progress",function(b,d){if(b!==d){if(w=parseInt(b,10)||0,w>100)return void(c.progress=100);if(0>w)return void(c.progress=0);e.onChange&&a(e.onChange)(c.$parent,{progress:w,target:u}),x=p(w),q()}});var w=c.progress,x=p(w);q(),setTimeout(function(){h.parentNode.classList.add("ez-loaded")},1e3)}}}]);