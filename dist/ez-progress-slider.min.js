angular.module("ez.progressSlider",[]).constant("EzProgressSliderConfig",{draggableTarget:!1,draggableProgress:!0,showProgressHandle:!0,showTargetHandle:!0,noInteraction:!1}).directive("ezProgressSlider",["$parse","EzProgressSliderConfig",function(a,b){return{restrict:"EA",templateUrl:"ez-progress-slider-tpl.html",replace:!0,require:"ngModel",scope:{target:"=?",config:"=?"},link:function(c,d,e,f){c.options=angular.extend({},b,c.config),c.hasTarget=!!e.target;for(var g in b)e[g]&&(c.options[g]=a(e[g])(c.$parent));var h,i=d.find(".progress"),j=d.find(".progress-bar"),k=d.parent(),l=d.find(".progress-handle"),m=d.find(".target-handle"),n=d.find(".progress-text");j.height(i.height());var o=function(){h=k.width()},p=function(a,b){return a=parseInt(a,10),b=parseInt(b,10),b>0?Math.round(a/b*100):0},q=function(a){return o(),a?parseInt((a*h/100).toFixed(0),10):0},r=function(){0>=h||(j.css({width:z+"px"}),l.css({left:z-10+"px"}),n.text(Math.round(y)+"%"),50>=y?d.addClass("under-50"):d.removeClass("under-50"),t(),s())},s=function(){c.hasTarget&&(w>y?d.addClass("behind-target"):d.removeClass("behind-target"))},t=function(){35>z?(n.css(c.options.noInteraction?{left:z+5+"px"}:{left:z+20+"px"}),n.css({color:"#333"})):n.css({color:"#fff",left:"5px"})};if(c.options.draggableProgress&&!c.options.noInteraction){d.addClass("draggable-progress"),interact(l[0]).draggable({axis:"x",onstart:function(){z=q(y)},onmove:function(a){return z+=a.dx,t(),0>z||z>h?void(z-=a.dx):(y=p(z,h),void r())},onend:function(){r(),f.$setViewValue(y),c.$apply()}});var u=function(a){angular.element(a.target);z=a.offsetX,y=p(z,h),r(),f.$setViewValue(y),c.$apply()};i.on("mousedown",u),j.on("mousedown",u)}if(c.hasTarget){var v=function(){m.css({left:q(w)+"px"}),m.attr("title",w+"%"),s()};c.options.draggableTarget&&(d.addClass("draggable-target"),interact(m[0]).draggable({axis:"x",onstart:function(){x=q(c.target)},onmove:function(a){return x+=a.dx,0>x||x>h?void(x-=a.dx):(w=p(x,h),void v())},onend:function(){v(),c.target=w,c.$apply()}})),c.$watch("target",function(a,b){a!==b&&(w=parseInt(a,10)||0,w>100?w=100:0>w&&(w=0),v())});var w=c.target,x=q(w);v()}else c.options.showTargetHandle=!1;f.$render=function(){console.log("render",f.$viewValue),y=parseInt(f.$viewValue,10)||0,y>100?y=100:0>y&&(y=0),z=q(y),r()};var y=0,z=q(y);r(),setTimeout(function(){d.addClass("ez-loaded")},1e3)}}}]);